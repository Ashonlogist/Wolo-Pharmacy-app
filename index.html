<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://code.jquery.com https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.sheetjs.com; style-src 'self' 'unsafe-inline' https://code.jquery.com https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.sheetjs.com; img-src 'self' data: https:; font-src 'self' https: data:; connect-src 'self' https:;">
    <title>Wolo - Pharmacy Inventory Management</title>
    
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    
    <!-- jQuery (required for some Bootstrap plugins) -->
    <script src="node_modules/jquery/dist/jquery.min.js"></script>

    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <script>
    // Global navigation function - must be defined first
    window.navigateTo = function(page) {
        try {
            // Simple page switching logic
            console.log(`Navigating to: ${page}`);
            
            // Hide all pages
            document.querySelectorAll('.page').forEach(el => {
                el.classList.remove('active');
            });
            
            // Show target page
            const targetPage = document.getElementById(page);
            if (targetPage) {
                targetPage.classList.add('active');
                console.log(`Successfully navigated to ${page}`);
            } else {
                console.error(`Page not found: ${page}`);
            }
        } catch (error) {
            console.error('Navigation error:', error);
        }
    };
    
    // Self-executing function to load jQuery and jQuery UI
    (function() {
        // Create a promise for jQuery loading
        window.jQueryPromise = new Promise((resolve) => {
            // Load jQuery
            const jqScript = document.createElement('script');
            jqScript.src = 'https://code.jquery.com/jquery-3.7.1.min.js';
            jqScript.onload = () => {
                console.log('jQuery loaded from CDN');
                loadJQueryUI(resolve);
            };
            jqScript.onerror = () => {
                console.warn('Failed to load jQuery from CDN, trying local...');
                const localJq = document.createElement('script');
                localJq.src = 'node_modules/jquery/dist/jquery.min.js';
                localJq.onload = () => {
                    console.log('jQuery loaded from local');
                    loadJQueryUI(resolve);
                };
                localJq.onerror = () => {
                    console.error('Failed to load jQuery from all sources');
                    resolve(false);
                };
                document.head.appendChild(localJq);
            };
            document.head.appendChild(jqScript);
        });

        // Function to load jQuery UI
        function loadJQueryUI(callback) {
            // Add jQuery UI CSS
            const jqueryUICSS = document.createElement('link');
            jqueryUICSS.rel = 'stylesheet';
            jqueryUICSS.href = 'https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css';
            document.head.appendChild(jqueryUICSS);

            // Load jQuery UI
            const jquiScript = document.createElement('script');
            jquiScript.src = 'https://code.jquery.com/ui/1.13.2/jquery-ui.min.js';
            jquiScript.onload = () => {
                console.log('jQuery UI loaded from CDN');
                initializeJQuery();
                callback(true);
            };
            jquiScript.onerror = () => {
                console.warn('Failed to load jQuery UI from CDN, trying local...');
                const localJqui = document.createElement('script');
                localJqui.src = 'node_modules/jquery-ui-dist/jquery-ui.min.js';
                localJqui.onload = () => {
                    console.log('jQuery UI loaded from local');
                    initializeJQuery();
                    callback(true);
                };
                localJqui.onerror = () => {
                    console.error('Failed to load jQuery UI from all sources');
                    initializeJQuery();
                    callback(true);
                };
                document.head.appendChild(localJqui);
            };
            document.head.appendChild(jquiScript);
        }

        // Initialize jQuery plugins
        function initializeJQuery() {
            if (window.jQuery) {
                console.log('jQuery version:', jQuery.fn.jquery);
                
                // Initialize datepickers
                if (jQuery.ui && jQuery.fn.datepicker) {
                    jQuery(document).ready(function($) {
                        $('.datepicker').datepicker({
                            dateFormat: 'yy-mm-dd',
                            changeMonth: true,
                            changeYear: true
                        });
                    });
                    console.log('jQuery UI version:', jQuery.ui.version);
                } else {
                    console.warn('jQuery UI datepicker not available');
                }
                
                // Expose jQuery to window for legacy code
                window.$ = window.jQuery;
            } else {
                console.error('jQuery not available');
            }
        }
    })();
    </script>
    
    <!-- Load jQuery first -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" 
            integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" 
            crossorigin="anonymous"></script>
            
    <!-- Load jQuery UI CSS -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css" 
          integrity="sha512-lCk0aEL6CvAGQvaZ47hoq1v/hNsunE8wD4xmmBelkJjg51DauW6uVdaWEJlwgAE6PxcY7/SThs1T4+IMwwpN7w==" 
          crossorigin="anonymous">
          
    <!-- Font Awesome (using jsDelivr instead of cdnjs to match CSP) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"
          integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
          crossorigin="anonymous">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"
        integrity="sha512-WWG/QztPBvezaRo3WuRRhsIuvpBPq0jqrQhuD6neZjle2/Fwj/spneB5NxBptNJDdYU/+u2bztZlDpz0JCHyBQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>window.Chart = window.Chart || {}; window.Chart.Chart = window.Chart.default || window.Chart;</script>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Initialize jQuery UI -->
    <script>
    // Function to ensure jQuery UI is loaded
    function ensureJQueryUI() {
        return new Promise((resolve, reject) => {
            if (window.jQuery && jQuery.ui) {
                console.log('jQuery UI already loaded, version:', jQuery.ui.version);
                resolve();
                return;
            }
            
            const jquiScript = document.createElement('script');
            jquiScript.src = 'https://code.jquery.com/ui/1.13.2/jquery-ui.min.js';
            jquiScript.integrity = 'sha384-M0G2KjAA+4tDk0b08QNlY5PAqTt1H0F0DEUbN4cUqy3JfFrt0U8D5M0X73HqrFm';
            jquiScript.crossOrigin = 'anonymous';
            
            jquiScript.onload = function() {
                console.log('jQuery UI loaded successfully');
                initializeDatepicker();
                resolve();
            };
            
            jquiScript.onerror = function() {
                console.warn('Failed to load jQuery UI from CDN');
                // Continue without jQuery UI
                resolve();
            };
            
            document.head.appendChild(jquiScript);
        });
    }
    
    // Function to load jQuery UI
    function loadjQueryUI() {
        return new Promise((resolve, reject) => {
            if (window.jQuery && jQuery.ui) {
                console.log('jQuery UI already loaded, version:', jQuery.ui.version);
                resolve();
                return;
            }
            
            const jquiScript = document.createElement('script');
            jquiScript.src = 'https://cdn.jsdelivr.net/npm/jquery-ui@1.13.2/dist/jquery-ui.min.js';
            jquiScript.integrity = 'sha512-57oZ/vW8ANMjR/KQ6Be9v/+/h6bq9/l3f0Oc7vn6qMqyhvPd1cvKBRWWpzu0QoneImqr2SkmO4MSqU+RpHom3Q==';
            jquiScript.crossOrigin = 'anonymous';
            
            jquiScript.onload = function() {
                console.log('jQuery UI loaded successfully');
                initializeDatepicker();
                resolve();
            };
            
            jquiScript.onerror = function() {
                console.warn('Failed to load jQuery UI from CDN');
                // Continue without jQuery UI
                resolve();
            };
            
            document.head.appendChild(jquiScript);
        });
    }
    
    // Initialize datepicker
    function initializeDatepicker() {
        if (jQuery && jQuery.fn.datepicker) {
            jQuery(document).ready(function($) {
                $('.datepicker').datepicker({
                    dateFormat: 'yy-mm-dd',
                    changeMonth: true,
                    changeYear: true,
                    yearRange: '2020:2030'
                });
            });
            console.log('Datepicker initialized');
        } else {
            console.warn('jQuery UI datepicker not available');
        }
    }
    
    // Initialize jQuery UI after jQuery is loaded
    document.addEventListener('DOMContentLoaded', () => {
        if (!window.jQuery) {
            console.error('jQuery not available');
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert alert-danger m-3';
            alertDiv.textContent = 'Critical Error: jQuery failed to load. Please check your internet connection and refresh the page.';
            document.body.insertBefore(alertDiv, document.body.firstChild);
            return;
        }
        
        console.log('jQuery version:', jQuery.fn.jquery);
        
        // Initialize jQuery UI
        ensureJQueryUI().catch(error => {
            console.error('Failed to initialize jQuery UI:', error);
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert alert-warning m-3';
            alertDiv.textContent = 'Some UI features may not work properly because jQuery UI failed to load completely.';
            document.body.insertBefore(alertDiv, document.body.firstChild);
        });
    });
    
    // If Electron is not available, do not provide any browser-side IPC shims.
    if (typeof window.electron === 'undefined') {
        console.warn('Electron API not available. IPC calls will fail in a browser.');
    }
    
    // Function to initialize the application
    function initializeApp() {
        console.log('jQuery version:', window.jQuery ? jQuery.fn.jquery : 'Not available');
        console.log('jQuery UI version:', window.jQuery && window.jQuery.ui ? jQuery.ui.version : 'Not loaded');
        
        // Initialize datepickers if available
        if (window.jQuery && jQuery.fn.datepicker) {
            jQuery('.datepicker').datepicker({
                dateFormat: 'yy-mm-dd',
                changeMonth: true,
                changeYear: true
            });
        }
        
        // If Electron is not available, do not provide any browser-side IPC shims.
        if (typeof window.electron === 'undefined') {
            console.warn('Electron API not available. IPC calls will fail in a browser.');
        }
        
        // Initialize any jQuery plugins that depend on the DOM being ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM fully loaded, initializing jQuery plugins...');
            
            // Your existing initializeJQueryPlugins function
            if (typeof initializeJQueryPlugins === 'function') {
                try {
                    initializeJQueryPlugins();
                } catch (e) {
                    console.error('Error in initializeJQueryPlugins:', e);
                }
            }
            
            // Initialize pages
            if (typeof initializePages === 'function') {
                try {
                    initializePages();
                } catch (e) {
                    console.error('Error initializing pages:', e);
                }
            }
        });
        
        // Trigger a custom event when everything is ready
        var event = new Event('app:ready');
        window.dispatchEvent(event);
    }

    // Simple script loader
    function loadScript(src, options = {}) {
        return new Promise((resolve, reject) => {
            const script = document.createElement('script');
            script.src = src;
            
            if (options.integrity) script.integrity = options.integrity;
            if (options.crossOrigin) script.crossOrigin = options.crossOrigin;
            
            script.onload = () => {
                console.log('Loaded:', src);
                resolve();
            };
            
            script.onerror = (error) => {
                console.error('Failed to load:', src, error);
                reject(error);
            };
            
            document.head.appendChild(script);
        });
    }

    // Load jQuery UI CSS
    const jqueryUICSS = document.createElement('link');
    jqueryUICSS.rel = 'stylesheet';
    jqueryUICSS.href = 'https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css';
    document.head.appendChild(jqueryUICSS);

    // Load scripts in sequence
    async function loadScripts() {
        // First, try to load jQuery from CDN without integrity check
        try {
            await loadScript('https://code.jquery.com/jquery-3.7.1.min.js');
            console.log('jQuery loaded from CDN');
        } catch (e) {
            console.warn('Failed to load jQuery from CDN, trying local...');
            try {
                await loadScript('node_modules/jquery/dist/jquery.min.js');
                console.log('jQuery loaded from local');
            } catch (e2) {
                console.error('Failed to load jQuery from local, using fallback CDN...');
                await loadScript('https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js');
                console.log('jQuery loaded from fallback CDN');
            }
        }

        // Now load jQuery UI
        try {
            await loadScript('https://code.jquery.com/ui/1.13.2/jquery-ui.min.js');
            console.log('jQuery UI loaded from CDN');
        } catch (e) {
            console.warn('Failed to load jQuery UI from CDN, trying local...');
            try {
                await loadScript('node_modules/jquery-ui-dist/jquery-ui.min.js');
                console.log('jQuery UI loaded from local');
            } catch (e2) {
                console.error('Failed to load jQuery UI from local, using fallback CDN...');
                await loadScript('https://ajax.googleapis.com/ajax/libs/jqueryui/1.13.2/jquery-ui.min.js');
                console.log('jQuery UI loaded from fallback CDN');
            }
        }

        // Initialize the app
        initializeApp();
    }

    // Start loading scripts
    loadScripts().catch(error => {
        console.error('Failed to load scripts:', error);
        // Try to initialize anyway with whatever we have
        initializeApp();
    });
    </script>
    
    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- XLSX Library for Excel export -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script>
        // Check if Bootstrap loaded successfully
        if (typeof bootstrap === 'undefined') {
            document.write('<script src="node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"><\/script>');
            console.warn('CDN Bootstrap failed to load, falling back to local Bootstrap');
        }
        
        // Initialize global functions
        window.showToast = function(message, type = 'info') {
            if (typeof bootstrap !== 'undefined' && bootstrap.Toast) {
                const toastEl = document.createElement('div');
                toastEl.className = `toast align-items-center text-white bg-${type} border-0`;
                toastEl.setAttribute('role', 'alert');
                toastEl.setAttribute('aria-live', 'assertive');
                toastEl.setAttribute('aria-atomic', 'true');
                toastEl.innerHTML = `
                    <div class="d-flex">
                        <div class="toast-body">
                            ${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                `;
                
                const toastContainer = document.getElementById('toastContainer') || (() => {
                    const container = document.createElement('div');
                    container.id = 'toastContainer';
                    container.className = 'position-fixed bottom-0 end-0 p-3';
                    container.style.zIndex = '11';
                    document.body.appendChild(container);
                    return container;
                })();
                
                toastContainer.appendChild(toastEl);
                const toast = new bootstrap.Toast(toastEl);
                toast.show();
                
                // Remove toast after it's hidden
                toastEl.addEventListener('hidden.bs.toast', () => {
                    toastEl.remove();
                });
                
                // Auto-hide after 5 seconds
                setTimeout(() => {
                    toast.hide();
                }, 5000);
            } else {
                console.log(`[${type}] ${message}`);
            }
        };
        
        // Navigation function - make sure it's available immediately
        window.navigateTo = function(page) {
            try {
                if (window.app && typeof window.app.navigateTo === 'function') {
                    window.app.navigateTo(page);
                } else {
                    console.log(`Navigate to ${page}`);
                    // Simple fallback navigation
                    const pages = document.querySelectorAll('.page');
                    if (pages.length > 0) {
                        pages.forEach(el => el.classList.remove('active'));
                        const targetPage = document.getElementById(`${page}-page`);
                        if (targetPage) {
                            targetPage.classList.add('active');
                        } else {
                            console.warn(`Target page not found: ${page}-page`);
                        }
                    } else {
                        // If no pages are found yet, try again after a short delay
                        console.log('Waiting for pages to load...');
                        setTimeout(() => window.navigateTo(page), 100);
                    }
                }
            } catch (error) {
                console.error('Navigation error:', error);
            }
        };
        
        // Make sure the function is available immediately
        console.log('Navigation initialized');
    </script>
    
    <!-- Core Utilities (must be loaded first) -->
    <script>
        // Make sure these functions are available globally
        window.showToast = function(message, type = 'info', duration = 3000) {
            if (window.toastr) {
                window.toastr[type](message);
            } else {
                console.log(`[${type.toUpperCase()}] ${message}`);
                // Create a simple toast if toastr is not available
                const toast = document.createElement('div');
                toast.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    padding: 15px;
                    background: #333;
                    color: white;
                    border-radius: 4px;
                    z-index: 9999;
                    min-width: 200px;
                `;
                toast.textContent = message;
                document.body.appendChild(toast);
                setTimeout(() => {
                    toast.remove();
                }, duration);
            }
        };

        window.showLoading = function(show, key = 'default') {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.style.display = show ? 'flex' : 'none';
            }
        };

        window.debounce = function(func, wait) {
            let timeout;
            return function(...args) {
                const context = this;
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(context, args), wait);
            };
        };
    </script>
    
    <!-- UUID for browser use -->
    <script src="https://cdn.jsdelivr.net/npm/uuid@8.3.2/dist/umd/uuidv4.min.js"></script>
    
    <!-- Core API Module (must be loaded before any scripts that use it) -->
    <script type="module">
        import { 
            products as productsApi, 
            sales as salesApi, 
            reports as reportsApi, 
            settings as settingsApi, 
            system as systemApi, 
            categories as categoriesApi, 
            suppliers as suppliersApi 
        } from './core/api.js';

        // Make APIs globally available
        window.productsApi = productsApi;
        window.salesApi = salesApi;
        window.reportsApi = reportsApi;
        window.settingsApi = settingsApi;
        window.systemApi = systemApi;
        window.categoriesApi = categoriesApi;
        window.suppliersApi = suppliersApi;

        console.log('API module loaded successfully');
    </script>
    
    <!-- Page Scripts (load after utilities) -->
    <script src="drag-drop.js"></script>
    
    <style>
    /* Drag and Drop Styling */
    .drop-zone {
        border: 2px dashed #ccc;
        border-radius: 8px;
        padding: 2rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        background-color: #f8f9fa;
        min-height: 200px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

    .drop-zone.highlight {
        border-color: #0d6efd;
        background-color: rgba(13, 110, 253, 0.1);
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    }

    .drop-zone p {
        margin: 0.5rem 0;
        color: #6c757d;
    }

    .drop-zone:hover {
        border-color: #0d6efd;
    }

    .drop-zone .bi {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        color: #6c757d;
    }

    .drop-zone.highlight .bi {
        color: #0d6efd;
    }
    </style>
    <script>
        // Check if running in Electron - wait for preload script to finish
        // With contextIsolation enabled, Electron APIs are exposed via contextBridge
        // This check runs after DOMContentLoaded to ensure preload has finished
        function checkElectronEnvironment() {
            // Check multiple indicators that Electron is available
            const hasElectron = typeof window.electron !== 'undefined' && 
                                typeof window.electron.ipcRenderer !== 'undefined';
            const hasProcess = typeof window.process !== 'undefined' && 
                              window.process.versions && 
                              window.process.versions.electron;
            
            window.isElectron = hasElectron || hasProcess;
            
            if (!window.isElectron) {
                // Retry after a short delay in case preload hasn't finished
                setTimeout(() => {
                    const retryCheck = typeof window.electron !== 'undefined' && 
                                     typeof window.electron.ipcRenderer !== 'undefined';
                    if (retryCheck) {
                        window.isElectron = true;
                        console.log('Electron environment detected - IPC available (delayed check)');
                    } else {
                        console.warn('Running in browser mode - Electron IPC not available. IPC calls will fail.');
                    }
                }, 100);
            } else {
                console.log('Electron environment detected - IPC available');
            }
        }
        
        // Run check when DOM is ready (preload should be done by then)
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', checkElectronEnvironment);
        } else {
            // DOM already loaded, check immediately
            checkElectronEnvironment();
        }
    </script>
    
    <!-- Initialize tooltips and datepickers -->
    <script>
        function initializeJQueryPlugins() {
            // Check if jQuery is loaded
            if (typeof jQuery == 'undefined') {
                console.error('jQuery is not loaded');
                return;
            }
            
            // Initialize tooltips
            if (jQuery.fn.tooltip) {
                jQuery('[data-bs-toggle="tooltip"]').tooltip();
            }
            
            // Initialize datepickers
            if (jQuery.fn.datepicker) {
                jQuery('.datepicker').datepicker({
                    dateFormat: 'yy-mm-dd',
                    changeMonth: true,
                    changeYear: true
                });
            }
        }
        
        // Run initialization when DOM is ready
        document.addEventListener('DOMContentLoaded', initializeJQueryPlugins);
    </script>
    
    <!-- Load renderer.js after all other scripts -->
    <script>
      // Wait for the document to be fully loaded
      document.addEventListener('DOMContentLoaded', function() {
        // Check if jQuery is loaded
        if (typeof jQuery === 'undefined') {
          console.error('jQuery is not loaded. The application may not work correctly.');
        } else {
          console.log('jQuery version:', jQuery.fn.jquery);
          // Initialize jQuery plugins
          initializeJQueryPlugins();
          
          // Load renderer.js as a module after jQuery is confirmed to be loaded
          const script = document.createElement('script');
          script.src = 'renderer.js';
          script.type = 'module';
          script.onerror = function() {
            console.error('Failed to load renderer.js');
          };
          document.body.appendChild(script);
        }
      });
    </script>
</head>
<body>
    <!-- Sidebar Navigation -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i class="bi bi-book"></i>
            </div>
            <h3>Wolo</h3>
            <small>Pharmacy Inventory</small>
        </div>
        
        <nav class="sidebar-nav">
            <a href="#" class="nav-item active" data-page="dashboard">
                <i class="bi bi-speedometer2"></i>
                <span>Dashboard</span>
            </a>
            <a href="#" class="nav-item" data-page="products">
                <i class="bi bi-box-seam"></i>
                <span>Products</span>
            </a>
            <a href="#" class="nav-item" data-page="sales">
                <i class="bi bi-cart-check"></i>
                <span>Record Sale</span>
            </a>
            <a href="#" class="nav-item" data-page="product-form">
                <i class="bi bi-plus-circle"></i>
                <span>Add Product</span>
            </a>
            <a href="#" class="nav-item" data-page="reports">
                <i class="bi bi-file-earmark-bar-graph"></i>
                <span>Reports</span>
            </a>
            <a href="#" class="nav-item" data-page="settings">
                <i class="bi bi-gear"></i>
                <span>Settings</span>
            </a>
            <a href="#" class="nav-item" id="helpButton" data-bs-toggle="modal" data-bs-target="#helpModal">
                <i class="bi bi-question-circle"></i>
                <span>Help & Support</span>
            </a>
        </nav>
    </div>

    <!-- Splash Screen - Shows on app load -->
    <div id="splash-screen" class="splash-screen">
        <div class="splash-content">
            <!-- Logo/Icon -->
            <div class="splash-logo">
                <div class="logo-icon">
                    <i class="bi bi-book"></i>
                </div>
            </div>
            
            <!-- App Name -->
            <h1 class="splash-title">WOLO</h1>
            <p class="splash-subtitle">Pharmacy Inventory Management</p>
            
            <!-- Animated Loader -->
            <div class="splash-loader">
                <div class="loader-ring"></div>
                <div class="loader-ring"></div>
                <div class="loader-ring"></div>
            </div>
            
            <!-- Progress Indicator -->
            <div class="splash-progress">
                <div class="progress-bar" id="splashProgressBar"></div>
            </div>
            
            <!-- Loading Text -->
            <p class="splash-loading-text" id="splashLoadingText">Initializing...</p>
            
            <!-- Developer Info -->
            <div class="splash-footer">
                <p class="splash-version">Version 1.0.0</p>
                <p class="splash-developer">Developed by <strong>Ashong Aaron Nii Nortey</strong></p>
                <p class="splash-email">aaronashong111@gmail.com</p>
            </div>
        </div>
    </div>

    <!-- Main Content Area - Hidden until splash completes -->
    <div class="main-content" id="mainContent" style="display: none;">
    <!-- Dashboard Page -->
        <div id="dashboard-page" class="page active">
            <div class="page-header">
                <h1>Dashboard</h1>
                <button class="btn btn-primary" id="refreshDashboardBtn">
                    <i class="bi bi-arrow-clockwise"></i> Refresh
                </button>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon bg-primary">
                        <i class="bi bi-box-seam"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="totalProducts">0</h3>
                        <p>Total Products</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon bg-success">
                        <i class="bi bi-currency-dollar"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="totalValue">$0.00</h3>
                        <p>Total Inventory Value</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon bg-warning">
                        <i class="bi bi-exclamation-triangle"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="lowStockCount">0</h3>
                        <p>Low Stock Items</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon bg-danger">
                        <i class="bi bi-calendar-x"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="expiringSoonCount">0</h3>
                        <p>Expiring Soon</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon bg-danger">
                        <i class="bi bi-x-circle"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="outOfStockCount">0</h3>
                        <p>Out of Stock</p>
                    </div>
                </div>
            </div>

            <!-- Alert Sections -->
            <div class="row mt-4">
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="bi bi-exclamation-circle"></i> Low Stock Alerts</h5>
                        </div>
                        <div class="card-body">
                            <div id="lowStockList" class="alert-list"></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="bi bi-calendar-event"></i> Expiring Soon</h5>
                        </div>
                        <div class="card-body">
                            <div id="expiringList" class="alert-list"></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="bi bi-x-circle"></i> Out of Stock</h5>
                        </div>
                        <div class="card-body">
                            <div id="outOfStockList" class="alert-list"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sales Analytics Section -->
            <div class="card mt-4" style="position: relative; z-index: 10; overflow: visible;">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Sales Analytics</h5>
                    <div class="d-flex gap-2">
                        <select id="chartType" class="form-select form-select-sm" style="width: auto;">
                            <option value="bar">Bar Chart</option>
                            <option value="line">Line Chart</option>
                        </select>
                        <button class="btn btn-sm btn-outline-secondary" id="refreshSalesChartBtn">
                            <i class="bi bi-arrow-clockwise"></i> Refresh
                        </button>
                    </div>
                </div>
                <div class="card-body" style="position: relative; z-index: 1;">
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label class="form-label">Date Range</label>
                            <div class="input-group input-daterange">
                                <input type="date" class="form-control form-control-sm" id="startDate">
                                <span class="input-group-text">to</span>
                                <input type="date" class="form-control form-control-sm" id="endDate">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Category</label>
                            <select id="categoryFilter" class="form-select form-select-sm">
                                <option value="">All Categories</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">View</label>
                            <select id="timeGrouping" class="form-select form-select-sm">
                                <option value="day">Daily</option>
                                <option value="week">Weekly</option>
                                <option value="month">Monthly</option>
                            </select>
                        </div>
                        <div class="col-md-2 d-flex align-items-end">
                            <button class="btn btn-primary btn-sm w-100" id="refreshSalesChartBtn2">
                                <i class="bi bi-funnel"></i> Apply
                            </button>
                        </div>
                    </div>
                    <div style="position: relative; height: 400px; width: 100%;">
                        <div class="chart-container" style="position: relative; height: 100%; width: 100%;">
                            <canvas id="salesChart" style="display: block; height: 100%; width: 100%;"></canvas>
                        </div>
                        <div id="chartTooltip" class="card d-none" style="position: absolute; z-index: 1050; max-width: 300px; pointer-events: none; box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);">
                            <div class="card-body p-2">
                                <h6 class="card-subtitle mb-2 text-muted">
                                    <span id="tooltipDate"></span>
                                    <span id="tooltipTime" class="ms-2 text-muted small"></span>
                                </h6>
                                <div id="tooltipContent" class="small"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Products Page -->
         <div id="products-page" class="page">
            <div class="page-header">
                <h1>Products</h1>
                <div class="header-actions">
                    <div class="btn-group me-2" role="group">
                        <button id="undoBtn" class="btn btn-outline-secondary" title="Undo (Ctrl+Z)">
                            <i class="bi bi-arrow-counterclockwise"></i> Undo
                        </button>
                        <button id="redoBtn" class="btn btn-outline-secondary" title="Redo (Ctrl+Y)">
                            <i class="bi bi-arrow-clockwise"></i> Redo
                        </button>
                    </div>
                    <button class="btn btn-success me-2" data-action="export-excel">
                        <i class="bi bi-file-earmark-excel"></i> Export
                    </button>
                    <div class="d-flex gap-2">
                        <button class="btn btn-primary" data-navigate-to="product-form">
                            <i class="bi bi-plus-lg"></i> Add Product
                        </button>
                        <button class="btn btn-outline-secondary" data-action="import-products">
                            <i class="bi bi-upload"></i> Import
                        </button>
                </div>
            </div>

            <!-- Import Products Modal -->
            <div class="modal fade" id="importProductsModal" tabindex="-1" aria-labelledby="importProductsModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="importProductsModalLabel">Import Products</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="info-warning info">
                                <i class="bi bi-info-circle"></i>
                                <div class="info-warning-text">
                                    <strong>Import Instructions:</strong> Your file should include columns: name, category, barcode, quantityInStock, costPrice, sellingPrice, expiryDate. Download the template for the exact format.
                                </div>
                            </div>
                            
                            <div class="drop-zone" id="drop-zone">
                                <i class="bi bi-cloud-upload" style="font-size: 3rem; color: var(--primary-color);"></i>
                                <p class="mt-3 mb-2">Drag and drop CSV or Excel files here</p>
                                <p class="small text-muted mb-3">or</p>
                                <button class="btn btn-outline-primary" id="selectFileBtn">
                                    <i class="bi bi-folder2-open"></i> Select Files
                                </button>
                                <input type="file" id="file-input" class="d-none" accept=".csv, .xlsx, .xls">
                            </div>
                            
                            <!-- File Preview -->
                            <div id="importPreview" class="mt-3" style="display: none;">
                                <h6>Preview (<span id="previewCount">0</span> products)</h6>
                                <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
                                    <table class="table table-sm table-bordered">
                                        <thead class="table-light sticky-top">
                                            <tr>
                                                <th>Name</th>
                                                <th>Category</th>
                                                <th>Stock</th>
                                                <th>Cost</th>
                                                <th>Price</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody id="previewTableBody">
                                        </tbody>
                                    </table>
                                </div>
                                <div id="importErrors" class="mt-2" style="display: none;">
                                    <div class="alert alert-warning">
                                        <strong>Validation Errors:</strong>
                                        <ul id="errorList" class="mb-0 small"></ul>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-3 d-flex justify-content-between align-items-center">
                                <div>
                                    <p class="small text-muted mb-1">Supported formats: .csv, .xlsx, .xls</p>
                                    <a href="#" id="downloadTemplate" class="small">
                                        <i class="bi bi-download"></i> Download template file
                                    </a>
                                </div>
                                <div id="fileInfo" class="text-muted small" style="display: none;">
                                    <span id="fileName"></span> â€¢ <span id="fileSize"></span>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary" id="processImport" disabled>
                                <i class="bi bi-upload"></i> Import Products
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            </div>

            <div class="filters-bar">
                <input type="text" id="searchInput" class="form-control" placeholder="Search products...">
                <select id="categoryFilter" class="form-select">
                    <option value="">All Categories</option>
                </select>
                <select id="stockFilter" class="form-select">
                    <option value="">All Stock</option>
                    <option value="low">Low Stock</option>
                    <option value="out">Out of Stock</option>
                </select>
                <select id="expiryFilter" class="form-select">
                    <option value="">All Expiry</option>
                    <option value="expiring">Expiring Soon</option>
                    <option value="expired">Expired</option>
                </select>
            </div>

            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th width="40">
                                <input type="checkbox" 
                                       id="selectAllProducts" 
                                       class="form-check-input" 
                                       onchange="toggleSelectAll(event)">
                            </th>
                            <th>Name</th>
                            <th>Category</th>
                            <th>Stock</th>
                            <th>Shelf</th>
                            <th>Unit Cost</th>
                            <th>Selling Price</th>
                            <th>Profit %</th>
                            <th>Expiry Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="productsTableBody">
                    </tbody>
                </table>
            </div>
            
            <!-- Pagination and Bulk Actions -->
            <div class="d-flex justify-content-between align-items-center mt-3">
                <div>
                    <span id="selectionCount" class="text-muted"></span>
                    <button id="bulkDeleteBtn" 
                            class="btn btn-sm btn-danger ms-2" 
                            disabled
                            onclick="handleBulkDelete()">
                        <i class="bi bi-trash"></i> Delete Selected
                    </button>
                    <button id="exportSelectedBtn" 
                            class="btn btn-sm btn-success ms-2" 
                            disabled
                            onclick="exportToExcel(true)">
                        <i class="bi bi-file-earmark-excel"></i> Export Selected
                    </button>
                </div>
                <div class="d-flex align-items-center gap-2">
                    <button id="prevPage" 
                            class="btn btn-sm btn-outline-secondary" 
                            onclick="changePage(-1)">
                        <i class="bi bi-chevron-left"></i> Previous
                    </button>
                    <span id="pageInfo" class="text-muted">Page 1 of 1</span>
                    <button id="nextPage" 
                            class="btn btn-sm btn-outline-secondary" 
                            onclick="changePage(1)">
                        Next <i class="bi bi-chevron-right"></i>
                    </button>
                </div>
            </div>
         </div>

        <!-- Add/Edit Product Page -->
        <div id="product-form-page" class="page">
            <div class="page-header">
                <h1 id="productFormTitle">Add New Product</h1>
                <button class="btn btn-secondary back-button" data-target="products">
                    <i class="bi bi-arrow-left"></i> Back
                </button>
            </div>

            <div class="card">
                <div class="card-body">
                    <div class="info-warning info">
                        <i class="bi bi-info-circle"></i>
                        <div class="info-warning-text">
                            <strong>Important:</strong> Fields marked with * are required. Ensure all pricing and inventory information is accurate before saving.
                        </div>
                    </div>
                    
                    <form id="productForm">
                        <input type="hidden" id="productId">
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Product Name *</label>
                                    <input type="text" class="form-control" id="productName" required list="productNamesList">
                                    <datalist id="productNamesList">
                                        <!-- Product names will be populated here -->
                                    </datalist>
                                    <small class="form-text text-muted">Enter the full product name as it appears on packaging</small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Barcode</label>
                                    <input type="text" class="form-control" id="productBarcode">
                                    <small class="form-text text-muted">Enter numeric barcode for quick product lookup</small>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Category</label>
                                    <input type="text" class="form-control" id="productCategory" list="categoryList">
                                    <datalist id="categoryList"></datalist>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Description</label>
                                    <input type="text" class="form-control" id="productDescription">
                                </div>
                            </div>
                        </div>

                        <div class="info-warning">
                            <i class="bi bi-exclamation-triangle"></i>
                            <div class="info-warning-text">
                                <strong>Pricing Information:</strong> Total Bulk Cost and Quantity Purchased are used to calculate the unit cost price automatically.
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Total Bulk Cost *</label>
                                    <input type="number" step="0.01" class="form-control" id="totalBulkCost" required>
                                    <small class="form-text text-muted">Total amount paid for the entire purchase</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Quantity Purchased *</label>
                                    <input type="number" class="form-control" id="quantityPurchased" required>
                                    <small class="form-text text-muted">Total units purchased in this batch</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Unit Cost Price</label>
                                    <input type="text" class="form-control" id="unitCostPrice" readonly>
                                    <small class="form-text text-muted">Calculated automatically (Bulk Cost Ã· Quantity)</small>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Profit Margin (%) *</label>
                                    <input type="number" step="0.01" class="form-control" id="profitMargin" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Selling Price</label>
                                    <input type="text" class="form-control" id="sellingPrice" readonly>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Marginal Profit</label>
                                    <input type="text" class="form-control" id="marginalProfit" readonly>
                                </div>
                            </div>
                        </div>

                        <div class="info-warning danger">
                            <i class="bi bi-exclamation-circle"></i>
                            <div class="info-warning-text">
                                <strong>Inventory Tracking:</strong> Quantity in Stock should match Quantity Purchased for new products. Quantity on Shelf cannot exceed Quantity in Stock.
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Quantity in Stock *</label>
                                    <input type="number" class="form-control" id="quantityInStock" required value="0">
                                    <small class="form-text text-muted">Total available units in inventory</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Quantity on Shelf *</label>
                                    <input type="number" class="form-control" id="quantityOnShelf" required value="0">
                                    <small class="form-text text-muted">Units currently displayed on sales floor</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Reorder Level</label>
                                    <input type="number" class="form-control" id="reorderLevel" value="10">
                                    <small class="form-text text-muted">Alert threshold for low stock warnings</small>
                                </div>
                            </div>
                        </div>

                        <div class="info-warning danger">
                            <i class="bi bi-calendar-x"></i>
                            <div class="info-warning-text">
                                <strong>Expiry Date Warning:</strong> Products expiring within 30 days will appear in the dashboard alerts. Ensure expiry dates are accurate to prevent selling expired products.
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Manufactured Date *</label>
                                    <input type="date" class="form-control" id="manufacturedDate" required>
                                    <small class="form-text text-muted">Date when product was manufactured</small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Expiry Date *</label>
                                    <input type="date" class="form-control" id="expiryDate" required>
                                    <small class="form-text text-muted">Product expiration date (critical for pharmacy items)</small>
                                </div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-save"></i> Save Product
                            </button>
                            <button type="button" class="btn btn-secondary" id="resetFormBtn">
                                <i class="bi bi-x-circle"></i> Reset
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Sales Page -->
        <div id="sales-page" class="page">
            <div class="page-header">
                <div>
                    <h1>Record Sale</h1>
                    <button class="btn btn-outline-secondary back-button" data-target="products">
                        <i class="bi bi-arrow-left"></i> Back to Products
                    </button>
                </div>
                <div class="btn-group" role="group">
                    <button id="undoBtnSales" class="btn btn-outline-secondary" title="Undo (Ctrl+Z)">
                        <i class="bi bi-arrow-counterclockwise"></i> Undo
                    </button>
                    <button id="redoBtnSales" class="btn btn-outline-secondary" title="Redo (Ctrl+Y)">
                        <i class="bi bi-arrow-clockwise"></i> Redo
                    </button>
                </div>
            </div>

            <!-- Date Range Picker -->
            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title">Sales Report</h5>
                    <div class="row g-3 align-items-center">
                        <div class="col-md-3">
                            <label for="startDate" class="form-label">Start Date</label>
                            <input type="date" class="form-control" id="startDate" value="">
                        </div>
                        <div class="col-md-3">
                            <label for="endDate" class="form-label">End Date</label>
                            <input type="date" class="form-control" id="endDate" value="">
                        </div>
                        <div class="col-md-3 d-flex align-items-end">
                            <button type="button" class="btn btn-primary me-2" id="loadSalesByDateRangeBtn">
                                <i class="bi bi-funnel"></i> Filter
                            </button>
                            <button type="button" class="btn btn-success export-excel-btn" data-action="export-sales-excel">
                                <i class="bi bi-file-earmark-excel"></i> Export
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sales Form -->
            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title">Record New Sale</h5>
                    <div class="info-warning info">
                        <i class="bi bi-info-circle"></i>
                        <div class="info-warning-text">
                            <strong>Sale Recording:</strong> Select a product, enter quantity, and the system will automatically calculate the total. Ensure stock is available before completing the sale.
                        </div>
                    </div>
                    <form id="saleForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="saleProduct" class="form-label">Product</label>
                                    <select class="form-select" id="saleProduct" required>
                                        <option value="">Select a product</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="mb-3">
                                    <label for="saleQuantity" class="form-label">Quantity</label>
                                    <input type="number" class="form-control" id="saleQuantity" min="1" value="1" required>
                                    <small class="form-text text-danger">Cannot exceed available stock</small>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="mb-3">
                                    <label for="saleUnitPrice" class="form-label">Unit Price (GHâ‚µ)</label>
                                    <div class="input-group">
                                        <span class="input-group-text">GHâ‚µ</span>
                                        <input type="number" class="form-control" id="saleUnitPrice" step="0.01" min="0.01" required readonly>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2 d-flex align-items-end">
                                <div class="mb-3 w-100">
                                    <label for="saleTotal" class="form-label">Total (GHâ‚µ)</label>
                                    <div class="input-group">
                                        <span class="input-group-text">GHâ‚µ</span>
                                        <input type="text" class="form-control" id="saleTotal" value="0.00" readonly>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label for="saleNotes" class="form-label">Notes (Optional)</label>
                                    <input type="text" class="form-control" id="saleNotes" placeholder="Add any notes about this sale">
                                </div>
                            </div>
                            <div class="col-md-4 d-flex align-items-end">
                                <button type="submit" class="btn btn-primary w-100">
                                    <i class="bi bi-cart-check me-2"></i>Record Sale
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Sales History -->
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Today's Sales</h5>
                    <div class="d-flex">
                        <div class="input-group me-2" style="width: 300px;">
                            <input type="date" class="form-control" id="exportStartDate">
                            <span class="input-group-text">to</span>
                            <input type="date" class="form-control" id="exportEndDate">
                            <button class="btn btn-outline-primary" type="button" id="exportSalesBtn">
                                <i class="bi bi-download me-1"></i> Export
                            </button>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Product</th>
                                    <th>Qty</th>
                                    <th>Unit Price</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody id="salesTableBody">
                                <!-- Sales will be populated by JavaScript -->
                            </tbody>
                            <tfoot>
                                <tr class="table-active">
                                    <th colspan="4" class="text-end">Total Sales:</th>
                                    <th id="salesTotal">GHâ‚µ 0.00</th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reports Page -->
        <div id="reports-page" class="page">
            <div class="page-header">
                <h1>Reports & Analytics</h1>
                <button class="btn btn-primary" id="generateReportBtn">
                    <i class="bi bi-file-earmark-text"></i> Generate Report
                </button>
            </div>

            <!-- Report Filters -->
            <div class="card mb-4">
                <div class="card-body">
                    <form id="reportForm">
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="reportType" class="form-label">Report Type</label>
                                <select class="form-select" id="reportType" required>
                                    <option value="">-- Select Report Type --</option>
                                    <option value="sales">Sales Report</option>
                                    <option value="inventory">Inventory Report</option>
                                    <option value="low-stock">Low Stock Report</option>
                                    <option value="expiring">Expiring Products</option>
                                </select>
                            </div>
                            <div class="col-md-4" id="dateRangeGroup">
                                <label for="reportStartDate" class="form-label">Date Range</label>
                                <div class="input-group">
                                    <input type="date" class="form-control" id="reportStartDate" required>
                                    <span class="input-group-text">to</span>
                                    <input type="date" class="form-control" id="reportEndDate" required>
                                </div>
                            </div>
                            <div class="col-md-4" id="categoryGroup" style="display: none;">
                                <label for="reportCategory" class="form-label">Category</label>
                                <select class="form-select" id="reportCategory">
                                    <option value="">All Categories</option>
                                    <!-- Categories will be loaded dynamically -->
                                </select>
                            </div>
                        </div>
                        <div class="row" id="lowStockThresholdGroup" style="display: none;">
                            <div class="col-md-4">
                                <label for="lowStockThreshold" class="form-label">Low Stock Threshold</label>
                                <input type="number" class="form-control" id="lowStockThreshold" value="10" min="1">
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Report Container -->
            <div class="card" id="reportContainer" style="display: none;">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0" id="reportTitle">Report</h5>
                    <div>
                        <button class="btn btn-sm btn-outline-secondary me-2" id="printReportBtn" title="Print Report">
                            <i class="bi bi-printer"></i> Print
                        </button>
                        <button class="btn btn-sm btn-outline-primary" id="exportPdfBtn" title="Export to PDF">
                            <i class="bi bi-file-pdf"></i> PDF
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover" id="reportTable">
                            <thead id="reportTableHeader">
                                <!-- Table headers will be generated by JavaScript -->
                            </thead>
                            <tbody id="reportTableBody">
                                <!-- Table data will be generated by JavaScript -->
                            </tbody>
                            <tfoot id="reportTableFooter">
                                <!-- Table footer will be generated by JavaScript -->
                            </tfoot>
                        </table>
                    </div>
                </div>
                <div class="card-footer text-muted" id="reportFooter">
                    Generated on <span id="reportGeneratedDate"></span>
                </div>
            </div>

            <!-- Report Summary Cards -->
            <div class="row mt-4" id="reportSummary" style="display: none;">
                <div class="col-md-3 mb-4">
                    <div class="card bg-primary text-white">
                        <div class="card-body">
                            <h6 class="card-title">Total Products</h6>
                            <h2 class="mb-0" id="totalProducts">0</h2>
                            <small>Across all categories</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="card bg-success text-white">
                        <div class="card-body">
                            <h6 class="card-title">In Stock</h6>
                            <h2 class="mb-0" id="totalInStock">0</h2>
                            <small>Items available</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="card bg-warning text-dark">
                        <div class="card-body">
                            <h6 class="card-title">Low Stock</h6>
                            <h2 class="mb-0" id="totalLowStock">0</h2>
                            <small>Items below threshold</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="card bg-danger text-white">
                        <div class="card-body">
                            <h6 class="card-title">Out of Stock</h6>
                            <h2 class="mb-0" id="totalOutOfStock">0</h2>
                            <small>Items to reorder</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Report Charts -->
            <div class="row mt-4" id="reportCharts" style="display: none;">
                <div class="col-md-6 mb-4">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Inventory by Category</h5>
                        </div>
                        <div class="card-body">
                            <canvas id="inventoryByCategoryChart" height="300"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 mb-4">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Stock Status</h5>
                        </div>
                        <div class="card-body">
                            <canvas id="stockStatusChart" height="300"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Export Buttons -->
            <div class="d-flex justify-content-end gap-2 mt-4" id="exportButtons" style="display: none;">
                <button class="btn btn-outline-primary" id="exportCsvBtn">
                    <i class="bi bi-file-earmark-excel"></i> Export to CSV
                </button>
                <button class="btn btn-outline-success" id="exportExcelBtn">
                    <i class="bi bi-file-earmark-spreadsheet"></i> Export to Excel
                </button>
                <button class="btn btn-outline-secondary" id="exportPdfBtn2">
                    <i class="bi bi-file-pdf"></i> Export to PDF
                </button>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="settings-page" class="page">
            <div class="page-header">
                <h1>Settings</h1>
            </div>

            <div class="card mb-4">
                <div class="card-header">
                    <h5><i class="bi bi-envelope-at"></i> Email Configuration (SMTP)</h5>
                </div>
                <div class="card-body">
                    <form id="smtpForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">SMTP Host</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="bi bi-hdd-network"></i></span>
                                        <input type="text" class="form-control" id="smtpHost" placeholder="smtp.gmail.com">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">SMTP Port</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="bi bi-ethernet"></i></span>
                                        <input type="number" class="form-control" id="smtpPort" placeholder="587">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Email</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="bi bi-envelope"></i></span>
                                        <input type="email" class="form-control" id="smtpUser" placeholder="your@email.com">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Password</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="bi bi-key"></i></span>
                                        <input type="password" class="form-control" id="smtpPass" placeholder="App password or SMTP password">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="smtpSecure">
                                <label class="form-check-label" for="smtpSecure">
                                    Use SSL/TLS
                                </label>
                            </div>
                        </div>
                        <div class="text-end">
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-save"></i> Save Settings
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h5><i class="bi bi-person-circle"></i> User Profile</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Your Name</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="bi bi-person"></i></span>
                            <input type="text" class="form-control" id="userNameSetting" placeholder="Enter your name">
                        </div>
                        <small class="form-text text-muted">This name will be used to personalize your experience throughout the app.</small>
                    </div>
                    <div class="text-end">
                        <button type="button" class="btn btn-primary" id="saveUserNameBtn">
                            <i class="bi bi-save"></i> Save Name
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h5><i class="bi bi-volume-up"></i> Sound Settings</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3 form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="soundEnabled" checked>
                        <label class="form-check-label" for="soundEnabled">
                            Enable Sound Effects
                        </label>
                        <small class="form-text text-muted d-block">Play sounds for actions, notifications, and interactions</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Sound Volume</label>
                        <input type="range" class="form-range" id="soundVolume" min="0" max="100" value="70">
                        <div class="d-flex justify-content-between">
                            <small class="text-muted">0%</small>
                            <small class="text-muted" id="soundVolumeValue">70%</small>
                            <small class="text-muted">100%</small>
                        </div>
                    </div>
                    <div class="text-end">
                        <button type="button" class="btn btn-primary" id="saveSoundSettingsBtn">
                            <i class="bi bi-save"></i> Save Sound Settings
                        </button>
                        <button type="button" class="btn btn-outline-secondary ms-2" id="testSoundBtn">
                            <i class="bi bi-play-circle"></i> Test Sound
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h5><i class="bi bi-shield-lock"></i> Security Settings</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Auto-lock after inactivity</label>
                        <select class="form-select" id="autoLockTimeout">
                            <option value="0">Never</option>
                            <option value="5">5 minutes</option>
                            <option value="15">15 minutes</option>
                            <option value="30">30 minutes</option>
                            <option value="60">1 hour</option>
                        </select>
                    </div>
                    <div class="mb-3 form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="developerMode">
                        <label class="form-check-label" for="developerMode">
                            Developer Mode
                        </label>
                        <small class="text-muted d-block">Enable additional debugging features and developer tools</small>
                    </div>
                    <div class="text-end">
                        <button type="button" class="btn btn-primary" id="saveSecuritySettingsBtn">
                            <i class="bi bi-save"></i> Save Security Settings
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Reset Data Section -->
            <div class="card border-danger">
                <div class="card-header bg-danger text-white">
                    <h5><i class="bi bi-exclamation-triangle"></i> Danger Zone</h5>
                </div>
                <div class="card-body">
                    <div class="info-warning danger">
                        <i class="bi bi-exclamation-circle"></i>
                        <div class="info-warning-text">
                            <strong>Warning:</strong> The reset action will permanently delete ALL data including products, sales, settings, and all other information. This action cannot be undone. Please ensure you have a backup before proceeding.
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <h6 class="text-danger">Reset All Data</h6>
                        <p class="text-muted">This will clear all data from the database and reset the application to its initial state. All products, sales records, and settings will be permanently deleted.</p>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="confirmResetCheckbox">
                            <label class="form-check-label text-danger" for="confirmResetCheckbox">
                                <strong>I understand this action cannot be undone</strong>
                            </label>
                        </div>
                    </div>
                    
                    <div class="text-end">
                        <button type="button" class="btn btn-danger" id="resetAllDataBtn" disabled>
                            <i class="bi bi-trash"></i> Reset All Data
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </div>


    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 9999; justify-content: center; align-items: center;">
        <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <!-- Welcome/User Name Modal -->
    <div class="modal fade" id="welcomeModal" tabindex="-1" aria-labelledby="welcomeModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="welcomeModalLabel">
                        <i class="bi bi-person-circle"></i> Welcome to Wolo Pharmacy!
                    </h5>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-4">
                        <div class="mb-3">
                            <i class="bi bi-book" style="font-size: 3rem; color: var(--primary-color);"></i>
                        </div>
                        <h4>Let's get started!</h4>
                        <p class="text-muted">Please enter your name to personalize your experience.</p>
                    </div>
                    <form id="welcomeForm">
                        <div class="mb-3">
                            <label for="userNameInput" class="form-label">Your Name *</label>
                            <input type="text" class="form-control form-control-lg" id="userNameInput" placeholder="Enter your name" required autofocus>
                            <small class="form-text text-muted">This will be used to personalize your experience throughout the app.</small>
                        </div>
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="bi bi-check-circle"></i> Continue
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Help & Support Modal -->
    <div class="modal fade" id="helpModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Help & Support</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6><i class="bi bi-question-circle"></i> Getting Started</h6>
                            <p>Learn how to use Wolo Inventory Management System with our comprehensive documentation.</p>
                            <a href="#" class="btn btn-sm btn-outline-primary">View Documentation</a>
                            
                            <h6 class="mt-4"><i class="bi bi-headset"></i> Support</h6>
                            <p>Need help? Contact our support team for assistance.</p>
                                <button class="btn btn-sm btn-outline-primary" id="contactSupportBtn">
                                <i class="bi bi-envelope"></i> Contact Support
                            </button>
                        </div>
                        <div class="col-md-6">
                            <h6><i class="bi bi-info-circle"></i> About Wolo</h6>
                            <p>Wolo Inventory Management System v1.0.0</p>
                            <p>Developed by Aaron Ashong (TheAshonlogist)</p>
                            <p>&copy; 2025 All Rights Reserved</p>
                            
                            <div class="mt-4">
                                <button class="btn btn-sm btn-outline-secondary" id="checkForUpdatesBtn">
                                    <i class="bi bi-arrow-repeat"></i> Check for Updates
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto">Notification</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body"></div>
        </div>
    </div>

    <!-- Page Scripts -->
    <script type="module">
        // Import navigation module
        import { setupNavigation, navigateTo } from './core/navigation.js';
        
        // Initialize the application when the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM fully loaded, initializing navigation...');
            
            // Initialize navigation
            try {
                setupNavigation();
                console.log('Navigation initialized successfully');
                
                // Show the initial page (default to dashboard)
                const initialPage = window.location.hash.replace('#', '') || 'dashboard';
                console.log('Navigating to initial page:', initialPage);
                navigateTo(initialPage);
                
                // Set up global event delegation
                function handleDocumentClick(event) {
                    // Handle export action
                    const exportBtn = event.target.closest('[data-action="export-excel"], .export-excel-btn');
                    if (exportBtn) {
                        event.preventDefault();
                        // The actual export handling is now in navigation.js
                        return;
                    }
                    
                    // Handle import action
                    const importBtn = event.target.closest('[data-action="import-products"]');
                    if (importBtn) {
                        event.preventDefault();
                        // Use Bootstrap's modal API to show the import modal
                        const importModal = new bootstrap.Modal(document.getElementById('importProductsModal'));
                        importModal.show();
                        return;
                    }
                }
                
                // Add the click listener
                document.addEventListener('click', handleDocumentClick);
                
                // Initialize tooltips
                const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
                tooltipTriggerList.map(function (tooltipTriggerEl) {
                    return new bootstrap.Tooltip(tooltipTriggerEl);
                });
                
            } catch (error) {
                console.error('Error initializing navigation:', error);
            }
        });
        
        // Make functions available globally
        window.navigateTo = navigateTo;
    </script>
    
    <!-- Load page-specific scripts -->
    <script src="pages/dashboard.js" type="module"></script>
    <script src="pages/products.js" type="module"></script>
    <script src="pages/product-form.js" type="module"></script>
    <script src="pages/sales.js" type="module"></script>
    <script src="pages/reports.js" type="module"></script>
    <script src="pages/settings.js" type="module"></script>
</body>
</html>
